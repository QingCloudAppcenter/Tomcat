#! /bin/bash
tomcat_war_temp="/tmp/war-temp"
tomcat_war_listen="/tmp/war-listen"
if [ ! -d $tomcat_war_temp ]
then
  mkdir $tomcat_war_temp
fi

if [ ! -d $tomcat_war_listen ]
then
  mkdir $tomcat_war_listen
fi

{{$war_source :=getv "/env/war_source"}}
{{$bucket :=getv "/env/qingstor_bucket"}}
{{$war_name :=getv "/env/qingstor_war_name"}}
# only download war when qingStor is enabled
{{if eq $war_source "qingstor"}}
qsctl cp -f qs://{{$bucket}}/{{$war_name}} /tmp/war-listen/
{{else if eq $war_source "tomcat_manager"}}
python /opt/apache-tomcat-7.0.78/bin/monitor-war.py &
{{else}}
exit 0
{{end}}
